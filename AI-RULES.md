# Система управления генерацией книги

## Обзор

Система управления генерацией книг с использованием ModelContextProtocol (MCP). Проект организован по принципу функциональной ясности, где каждый компонент имеет четкую ответственность.

## Структура каталогов

### Backend (`src/backend/`)

#### `app/routers/`
- API-эндпоинты и маршрутизация
- Каждый файл - отдельный модуль API (files.py, versions.py и т.д.)
- Не должен содержать бизнес-логику, только валидацию и маршрутизацию

#### `app/services/`
- Простые сервисы с единой ответственностью
- Каждый сервис взаимодействует только с одним типом ресурсов
- Примеры: file_service.py (работа с файлами), markdown_service.py (обработка Markdown)
- Не должны зависеть от других сервисов

#### `app/core/`
- Сложная интеграционная логика, объединяющая несколько сервисов
- Реализация высокоуровневого функционала системы
- Примеры: bible_manager.py, template_manager.py, context_provider.py
- Используется для логики, выходящей за рамки одного сервиса

#### `app/models/`
- Модели данных и схемы Pydantic
- Определяет структуру данных для API и внутренних процессов
- Не должен содержать бизнес-логику

#### `data/`
- Хранилище Markdown-файлов
- `canon/`: правила мира и основной канон
- `bible/`: элементы мира (персонажи, локации, технологии)
- `templates/`: шаблоны промптов для работы с ИИ

### Frontend (`src/frontend/`)

#### `src/components/`
- React-компоненты пользовательского интерфейса
- Организованы по функциональным модулям
- Не должны содержать бизнес-логику

#### `src/services/`
- API-клиенты и сервисы для взаимодействия с бэкендом
- Обработка данных перед отправкой/после получения

#### `src/types/`
- TypeScript типы и интерфейсы
- Определяет типы данных для фронтенда

## Форматы файлов

- Markdown-файлы (`.md`) - основной формат хранения данных
- Вся информация о мире должна быть оформлена в виде таблиц, где это уместно
- Файлы шаблонов должны содержать четкие заполнители для динамического контента, используя синтаксис `{{variable}}`
- История версий хранится рядом с каждым файлом и должна использоваться для сравнения

## Принципы размещения кода

1. **Единая ответственность**: каждый модуль отвечает за одну функцию
2. **Минимальные зависимости**: базовые сервисы не зависят друг от друга
3. **Интеграция в core**: сложная логика выносится в core
4. **Файлы как источник правды**: все данные хранятся в Markdown-файлах
5. **Отделение API от логики**: routers только маршрутизируют запросы

## Заметки по реализации для ИИ

- При поиске контекста приоритизируйте сначала директорию `canon/`, затем `bible/`
- Файлы в `templates/` содержат инструкции для задач генерации
- При обработке таблиц сохраняйте их структуру точно в соответствии с указанной
- Новый функционал размещайте в соответствующих каталогах
- Для сложной логики с множественными зависимостями используйте `app/core/`
- Сохраняйте атомарность сервисов в `app/services/`
- При работе с файлами всегда используйте file_service, не прямой доступ к файловой системе
